<%- include('../partials/head') %>
<%- include('../partials/leftSidebar.ejs') %>
<%- include('../partials/header.ejs') %>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<div class="main-content">
  <div class="card card-custom">
    <div class="card-header-custom d-flex justify-content-between p-1">
        <h3 class="ms-2"> Specialization </h3>
        <button type="button" class="btn add-btn-specialization me-2" data-bs-target="#add-specialization" data-bs-toggle="modal" >
            <i class="fas fa-plus p-1"></i>
        </button>  
    </div>
    <div class="card-body table-responsive">
        <div class="d-flex justify-content-between">
            <div>
                <label>Show Entries</label>
                <select class="form-select" id="changeEntry">
                    <%for(let page of locals.page_filter){%>
                       <option value="<%-page%>"><%-page%></option>
                    <%}%>
                </select>
            </div>
            <div>
                <div class="table-searchbar-container"><button type="button"><i class="fas fa-search"></i> </button><input
                    type="search" id="searchkeyword" placeholder="Enter keywords" class="table-searchbar"></div>
            </div>
        </div>

        <table class="table custom_row table-bordered mt-4 custom-table" id="specialization-table">
            <thead>
                <th>Sr No.</th>
                <th>Specialization Name</th>
                <th>Action</th>
                
            </thead>
            <tbody>
                <% let count = 1 %>
                <%for(let specialization of specializationList) {%>
                    <tr>
                        <td><%- count++ %></td>
                        <td><%-specialization.concentration_name %></td>
                        <td>
                            <a class="edit-specialization" data-bs-target="#edit-specialization-modal" data-bs-toggle="modal" data-specialization-id="<%- specialization.id %>" data-specialization-name="<%- specialization.concentration_name %>"> <i class="fa fa-edit"></i></a>
                            <a class="delete-specialization" data-specialization-id="<%- specialization.id %>" > <i class="fa fa-trash text-danger"></i></a>
                        </td> 
                    </tr>
                <%}%>
            </tbody>
        </table>
        <div class="d-flex justify-content-between">
            <div>
                <p>Total entries:&nbsp;<span id="page-no"></span>
                </p>
            </div>
            <div>
                <p id="pagination" class="pagination-search"></p>
            </div>
        </div>
    </div>
  </div>  
</div>


<div class="modal" id="add-specialization">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Specialization</h3>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <label class="form-label mb-2" for="specialization-name">Specialization Name :</label>
              <input class="form-control" id="specialization-name">
              
              </div>   
        
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" id="add-specialization-name">Add</button>
            </div>
        </div>
    </div>
 </div>       
<div class="modal" id="edit-specialization-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Update Specialization</h3>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <label class="form-label mb-2" for="previous-specialization-name">Previous Specialization Name :</label>
              <input type="hidden" id="specialization-id">
              <input class="form-control" type="text" id="previous-specialization-name" disabled readonly>              
              <label class="form-label mb-2" for="new-specialization-name">New Specialization Name :</label>
              <input class="form-control" type="text" id="new-specialization-name">    
              </div>   
        
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" id="edit-specialization-button">Update</button>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function() {

        let test = '<%- pageCount %>';
        let rowCount = $('#changeEntry').val();
        $('#page-no').html(test);
        paginationData(rowCount, parseInt(test));

        
        $('#searchkeyword').on('input',function(){

         let specializationValue = $(this).val();
         let showEntry = $('#changeEntry').val();

            $.ajax({
            type:'POST',
            url:'/admin/specialization/search',
            data:{
            searchLetter:specializationValue,
            showEntry:showEntry
            },
            success:function(data){
            paginationData(rowCount,data.length)
            AjaxtTable(data.data)
            }
            })
        })       

            $(".pagination-search").on('click','.pagination li',function(){
                let keyword = $("#searchkeyword").val();
                let showEntry = $('#changeEntry').val();
                let pageNo = $(this).attr('data-lp');

                $.ajax({
                    type: "POST",
                    url: "/admin/specialization/search",
                    data: {
                        searchLetter: keyword,
                        pageNo: pageNo,
                        showEntry:showEntry
                    },
                    success: function (data) {
                        AjaxtTable(data.data);
                        console.log(data.data);
                    }
                });
            });

            $('#changeEntry').on('change',function(){
            let showEntry = $(this).val();
            let ApiObj = {
                type:'POST',
                url:'/admin/specialization/showEntrySpecializationList',
                data:{
                    showEntry:showEntry
                },
                datatype:'JSON'
                }
                ajaxApi(ApiObj).then(result=>{
                    AjaxtTable(result.data)
                    paginationData(showEntry,result.length)
                }).catch(error =>{
                showError(error.responseJSON);
                })    
            })

        function paginationData(rowCount, totalCount) {
            let pageNos = Math.ceil(Number(totalCount) / Number(rowCount));
            console.log("Page Numbers", pageNos);
            $('#pagination').bootpag({
                total: pageNos,
                page: 1,
                maxVisible: 10,
                leaps: true,
                firstLastUse: true,
                first: '←',
                last: '→',
                wrapClass: 'pagination',
                activeClass: 'active', 
                disabledClass: 'disabled',
                nextClass: 'next',
                prevClass: 'prev',
                lastClass: 'last',
                firstClass: 'first'
            }).on("page", function (event, num) {
               
            });
        }
		
     $('#add-specialization-name').on('click',function(){  
        let specializationName = $('#add-specialization #specialization-name').val().replace(/\s+/g,' ').trim();
        
        let ApiObj ={
            url:'/admin/specialization/add',
            type:'POST',
            data:{
                concentration_name:specializationName
            },
            datatype :'JSON'
        }
        ajaxApi(ApiObj).then(result =>{
            showSuccess(result);
        }).catch(error =>{
            showError(error.responseJSON);
        })
     })   

    $('#specialization-table').on('click','.delete-specialization',function(){
        let specializationId = $(this).attr('data-specialization-id');
        console.log('values of specializationId',specializationId);
        let ApiObj = {
            url:'/admin/specialization/delete',
            type:'POST',
            data:{
                specializationId:specializationId
            },
            datatype:'JSON'
        }
        ajaxApi(ApiObj).then(result =>{
            showSuccess(result);
        }).catch(error =>{
            showError(error.responseJSON);
        })
    })

    $('#edit-specialization-modal').on('click','#edit-specialization-button',function(){
        let specializationId = $('#edit-specialization-modal #specialization-id').val();
        let specializationName = $('#edit-specialization-modal #new-specialization-name').val().replace(/\s+/g,' ').trim();
      
        let ApiObj = {
            url:'/admin/specialization/update',
            type:'POST',
            data:{
                id:specializationId,
                concentration_name:specializationName
            },
            datatype:'JSON'
        }
        ajaxApi(ApiObj).then(result =>{
            showSuccess(result);
        }).catch(error =>{
            console.log('values of error',error.responseJSON);
            showError(error.responseJSON);
        })
    })
    $('#specialization-table').on('click','.edit-specialization',function(){
        let specializationName = $(this).attr('data-specialization-name');
        let specializationId = $(this).attr('data-specialization-id')
       $('#edit-specialization-modal #specialization-id').val(specializationId);
       $('#edit-specialization-modal #previous-specialization-name').val(specializationName);
    });
})

function showError(errors) {
            console.log(errors);
            console.log('values of description',errors)
            let simpleAlert = new SimpleAlert();
            let obj = {
                title : errors.description,
                message: "",
                type: 'alert-danger',
                buttons: {
                    positive:{
                        text: "Okay",
                        action: function(){
                            document.querySelector('.simple-alert').remove();
                        }
                    },
                    negative: {
                        text: "Cancel",
                        action: function () {
                        alert('Negative')
                        }
                    }
                }
            }
            simpleAlert.alert(obj);
            }
            function IsNumber(inputString) {
                let isNumber = false;
                for (let i = 0; i < inputString.length; i++) {
                const charCode = inputString.charCodeAt(i);
                if (charCode >= 48 && charCode <= 57) {
                    isNumber = true;
                }else{
                    isNumber = false;
                }
                }
                return isNumber;
            }
            function AjaxtTable(specializationList) {
           $("#specialization-table tbody").empty();
           let AjaxTable = ``;
           if (specializationList.length > 0) {
               let count = 1;
               for (specialization of specializationList) {
                   AjaxTable +=
                       `<tr>
                           <td>${count++}</td>
                           
                           <td>${specialization.concentration_name}</td>
                
                           <td>
                            <a class="edit-specialization" data-bs-target="#edit-specialization-modal" data-bs-toggle="modal" data-id="${specialization.id}" data-specialization-name="${specialization.concentration_name}">
                           <i class="fa fa-edit"></i></a>
                           <a class="delete-specialization" data-id="${specialization.id}"><i class="fa-solid fa-trash text-danger"></i></a>
                           </td>
                       </tr>`
               }
           }
           
                  
           $("#specialization-table tbody").html(AjaxTable);
       }
</script>
  
<%- include('../partials/footer.ejs') %>

<%- include('../partials/footerEnd.ejs') %>