
<%- include('../partials/head') %>
<%- include('../partials/leftSidebar.ejs') %>
<%- include('../partials/header.ejs') %>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>

<div class="main-content">
    <div class="col-12">
        <div class="breadcrumb" style="margin: 10px 0;">
            <a style="text-decoration: none; color: #007bff; font-weight: bold;" href="javascript:void(0)">Courseworkload</a>
            <i class="fa fa-home" aria-hidden="true" style="margin: 0 5px;"></i>
            <a href="javascript:void(0)" style="text-decoration: none;">Concentration</a>
        </div>
    </div>

    <div class="card card-custom" >
        <div class="card-header-custom d-flex justify-content-between p-2">
            <h4 class="ms-2">Concentration Settings</h4>
            <button type="button" class="btn btn-danger ms-auto me-3"  id="refresh-concentration-settings">
                <i class="fa-solid fa-rotate p-1"></i>Refresh
            </button> 
        </div>
        <div class="card-body table-responsive" >
            <table class="table custom_row table-bordered mt-4" id="concentration-settings-table">
                <thead>
                  <tr>
                    <th>id</th>
                    <th>Concentration</th>
                    <th>Total Elective Credits</th>
                    <th>Max Credits Per Area</th>
                    <th>No of Area to Cover</th>
                    <th>Min Credits Per Area</th>
                    <th>Primary Area</th>
                    <th>Min Credits In Primary Area</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% let count = 1 %>
                  <% for(let concentrationSetting of concentrationSettingList) { %>
                    <tr>
                      <td><%- count++ %></td>
                      <td class="concentration-name"><%- concentrationSetting.concentration_name %></td>
                      <td><%- concentrationSetting.total_elective_credits%></td>
                      <td><%- concentrationSetting.max_credits_per_area %></td>
                      <td><%- concentrationSetting.no_of_areas_to_cover %></td>
                      <td><%- concentrationSetting.min_credits_per_area %></td>
                      <td><%- concentrationSetting.primary_area %></td>
                      <td><%- concentrationSetting.min_credits_in_primary_area %></td>
                      <td>
                        <a class="edit-concentration-settings" data-concentration-setting-id="<%- concentrationSetting.id %>" data-bs-toggle="modal" data-bs-target="#edit-concentration-setting-modal"><i class="fa fa-edit"></i></a>
                        <a class="text-danger delete-concentration-settings" data-concentration-setting-id="<%- concentrationSetting.id %>"><i class="fas fa-trash"></i></a>
                      </td>
                      </td>
                    </tr>
                    
                  <%}%>
                </tbody>
              </table>
        </div>
    </div>
    


      <div class="modal" id="edit-concentration-setting-modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Update Concentration Settings</h3>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                  <div class="row">
                      <div class="col-md-6">
                        <label class="mb-2 form-label" for="concentration-name">Concentration Name:</label>
                        <input type="hidden" id="course-id">
                        <input class="form-control" type="text" id="concentration-name" disabled>
                  
                      </div>
                 

                  <div class="col-md-6">
                    <label class="mb-2 form-label" for="min-credits-in-primary-area">Min Credits in Primary Area:</label>
                    <input type="hidden" id="course-id">
                    <input class="form-control" type="text" id="min-credits-in-primary-area">
                  </div>
                
                  
                    </div>
                    <div class="row">
                  
                    <div class="col-md-6">
                      <label class="form-label mb-2" for="max-credits-per-area">Maximum Credits Per Area:</label>
                      <input class="form-control" type="text" id="max-credits-per-area">
                      <span id="error-min-demand-criteria" class="text-danger d-none">Min Demand Creteria Allow Only Numbers</span>
                    </div>
                    <div class="col-md-6">
                      <label  class="form-label mb-2" for="min-credits-per-area">Minimum Credit Per Area:</label>
                      <input class="form-control" type="text" id="min-credits-per-area">
                      <span id="error-min-demand-criteria" class="text-danger d-none">Min Demand Creteria Allow Only Numbers</span>
                    </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <label class="mb-2 form-label" for="course-credits">Total Elective Credits :</label>
                        <input class="form-control" type="text" id="total-elective-credits">
                        <span id="error-credits" class="text-danger d-none">Credits Allow Only Numbers</span>
                    </div>
                    <div class="col-md-6">
                      <label class="mb-2 form-label" for="number-of-areas-to-cover">Number Of Areas To Cover:</label>
                      <input class="form-control" type="text" id="number-of-areas-to-cover">
                      <span id="error-credits" class="text-danger d-none">Credits Allow Only Numbers</span>
                  </div>
                    </div>
                    <div>
                      <label class="mb-2 form-label" for="primary-area">Primary Area :</label>
                    <select class="form-control form-select select2 custom-select" id="primary-area">
                   
                      <% for(let area of areaList){ %>
                        <option value="<%- area.id %>"><%- area.area_name %></option>
                        <% }%>
                    </select>
                    <span id="error-year-of-intro" class="text-danger d-none">Invalid Year of introduction</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button class="btn btn-primary" id="update-concentration-settings">Update</button>
                </div>
            </div>
        </div>
    </div>
<script src='../../../../public/js/simpleAlert/simpleAlert.js'></script>
          
<script>
   $(document).ready(function(){
    
    $('#refresh-concentration-settings').on('click',function(){
      console.log('refresh concentration settings');
      let ApiObj = {
        url:'/admin/concentration-settings/refresh',
        type:'POST',
        data:{},
        dataType:'JSON'
      }
      ajaxApi(ApiObj).then(result =>{
        showSuccess(result);
      }).catch(error =>{
        console.log('values of error',error);
        showError(error.responseJSON);
      })
    })
$('#concentration-settings-table').on('click','.delete-concentration-settings',function(){
      let concentrationId = $(this).attr('data-concentration-setting-id');
  
      let ApiObj = {
                url:'/admin/concentration-settings/delete',
                type:'POST',
                data:{
                   id:concentrationId
                },
                dataType:'JSON'
            }
            ajaxApi(ApiObj).then(result =>{
                console.log('response:::::::',result);
                showSuccess(result)
            }).catch(error =>{
                console.log('error:::::',error);
                showError(error.responseJSON)
            })

        })


     $('#concentration-settings-table').on('click','.edit-concentration-settings',function(){
      let editConcentration = $('.edit-concentration-settings').closest('tr').find('td.concentration-name').text();
      $('#edit-concentration-setting-modal #concentration-name').val(editConcentration);
     
      let concentrationSettingsId = $(this).attr('data-concentration-setting-id');
      $('#edit-concentration-setting-modal #concentration-name').attr('data-id',concentrationSettingsId);
      console.log('valueso fconc',concentrationSettingsId);
     })

     $('#edit-concentration-setting-modal').on('click', '#update-concentration-settings', function(){
  console.log('values edit concentration is click now');
  let id = $('#concentration-name').attr('data-id');
  let concentrationName = $('#concentration-name').val();
  let minCreditsInPrimaryArea = $('#min-credits-in-primary-area').val();
  let maxCreditsPerArea = $('#max-credits-per-area').val();
  let minCreditsPerArea = $('#min-credits-per-area').val();
  let totalElectiveCredits = $('#total-elective-credits').val();
  let numberOfAreasToCover = $('#number-of-areas-to-cover').val();
  let primaryAreaOption = $('#primary-area option:selected').val();

  let editConcentrationsettings = {
    id:id,
    total_elective_credits: totalElectiveCredits,
    max_credits_per_area: maxCreditsPerArea,
    no_of_areas_to_cover: numberOfAreasToCover,
    min_credit_per_area: minCreditsPerArea,
    primary_area: primaryAreaOption,
    min_credits_in_primary_area: minCreditsInPrimaryArea
  };

  let ApiObj = {
    type: 'POST',
    url: '/admin/concentration-settings/update',
    data:{  editConcentrationsettings : JSON.stringify(editConcentrationsettings)},
    dataType: 'JSON'
  };
   console.log('valuesof ApiObj',ApiObj);
  ajaxApi(ApiObj)
    .then(result => {
      console.log('values of result', result);
      showSuccess(result);
    })
    .catch(error => {
      console.log('values of error', error);
   //   showSuccess(error.responseJSON);
       showError(error.responseJSON);
    });
});

    });
    
    function showError(errors) {
            console.log(errors);
            console.log('values of description',errors)
            let simpleAlert = new SimpleAlert();
            let obj = {
                title : errors.description,
                message: "",
                type: 'alert-danger',
                buttons: {
                    positive:{
                        text: "Okay",
                        action: function(){
                            document.querySelector('.simple-alert').remove();
                        }
                    },
                    negative: {
                        text: "Cancel",
                        action: function () {
                        alert('Negative')
                        }
                    }
                }
            }
            simpleAlert.alert(obj);
            }

</script>
<%- include('../partials/footer.ejs') %>
<%- include('../partials/footerEnd.ejs') %>

