<%- include('../partials/head') %>

<%- include('../partials/leftSidebarForStudent.ejs') %>
<%- include('../partials/header.ejs') %>

<div class="main-content">
  <div class="card card-custom-border-curv">
    <div class="card-header-custom d-flex justify-content-between p-1">
        <h3 class="ms-2"> Bidding</h3>  
    </div>
    <div class="card-body table-responsive">
     
    </div>
  </div>
  
  <div class="card card-custom-border-curv mt-5 bidding-modal">
    <div class="card-header-custom d-flex justify-content-between p-1">
        <h3 class="ms-2">Available Courses</h3>
    </div>
 
    <div class="card-body table-responsive">
        <div class="d-flex">
          <% for(let acadSession of dropdownAcadSessionList) { %>
            <div class="col-sm-4 p-2">
              <button class="btn btn-light w-100 border bidding-trimester"  data-acad-session-id = "<%- acadSession.sap_acad_session_id %>">
                <%-acadSession.acad_session %>
              </button>
            </div>
          <% } %>
        </div> 
        <table class="table custom_row table-bordered mt-4 custom-table" id="bidding-trimester-select-table">
            <thead>
                <th>Area</th>
                <th>Course</th>
                <th>Trimester</th>
                <th>Credits</th>
            </thead>
            <tbody>

            </tbody>
         </table>
  </div>
</div>
<%- include('../partials/footer.ejs') %>
<script>
$(document).ready(function() {
    let active = `<%- active %>`;
    $('#sidebar .side-menu li.' + active).addClass('active');

    $('.bidding-modal').on('click', '.bidding-trimester', function() {
       $('#bidding-trimester-select-table tbody').empty();
       let prevSelected = $(this).closest('div').siblings().find('.bidding-trimester-selected');
       prevSelected.removeClass('bidding-trimester-selected');
       $(this).addClass('bidding-trimester-selected');
       $(this).css('--bidding-trimester-active', $(this).innerHeight() + 'px');

       let acadSessionId = $(this).data('acad-session-id');
       
       let ApiObj = {
        type: 'POST',
        url: '/student/bidding/course-by-acadsession',
        data:{
          acadSessionId: acadSessionId
        },
        dataType :'JSON',
       }
      ajaxApi(ApiObj).then(result =>{
        console.log('values of result,',result);
        showData(result.biddingCourseList);
      }).catch(error =>{
        showError(JSON.stringify(error.responseJSON))
      })
   });

});

function showData(biddingCourseList){
  let biddingTrimesterTable = $('#bidding-trimester-select-table tbody');
  if(biddingCourseList.length > 0 ){
    for(let biddingCourse of biddingCourseList){
      biddingTrimesterTable.append(`
          <tr>
            <td>${biddingCourse.area_name}</td>
            <td>${biddingCourse.course_name}</td>
            <td>${biddingCourse.acad_session}</td>
            <td>${biddingCourse.credits}</td>
          </tr>`);
    }
  }
}

</script>

<%- include('../partials/footerEnd.ejs') %>